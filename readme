Translated code from Japanese version.
